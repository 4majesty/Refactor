package com.successfactors.cdp.service.mentoring.impl;

import com.successfactors.cdp.app.mentoring.MentoringServiceBase;
import com.successfactors.cdp.bean.mentoring.MentoringProgram;
import com.successfactors.cdp.service.mentoring.DeleteProgram;
import com.successfactors.cdp.service.util.mentoring.ProgramStatusEnum;
import com.successfactors.genericobject.api.processor.ValidationContext;
import com.successfactors.genericobject.app.datamodel.ConfigurationProvider;
import com.successfactors.genericobject.service.SaveBean;
import com.successfactors.logging.api.LogManager;
import com.successfactors.logging.api.Logger;
import com.successfactors.platform.bean.ParamBean;
import com.successfactors.sca.ServiceApplicationException;
import com.successfactors.sca.ServiceCommandHandler;
import com.successfactors.sca.ServiceCommandImpl;
import com.successfactors.sca.config.Service;
import org.jboss.seam.annotations.In;

import javax.inject.Inject;

/**
 * Created by root on 12/16/16.
 */
@Service
public class DeleteProgramImpl implements ServiceCommandImpl<Void, DeleteProgram> {

  @Inject
  @In
  private ParamBean params;

  @Inject
  @In
  private transient ServiceCommandHandler scaHandler;

  @Inject
  @In(create = true)
  private ConfigurationProvider configurationProvider;

  /**
   * Logger
   */
  private static Logger logger = LogManager.getLogger();

  @Inject
  @In(create = true)
  private MentoringServiceBase mentoringServiceBase;


  @Override
  public Void execute(DeleteProgram cmd) throws ServiceApplicationException {
    MentoringProgram program = mentoringServiceBase.getProgramById(cmd.getProgramId());
    if(program==null)
    {
        logger.info("Should not happen. Probably being hacked.");
        throw new ServiceApplicationException("Cannot find the program!");
    }

    if(program.getStatus()==cmd.getTargetStatus()) {
        program.setStatus(ProgramStatusEnum.DELETED);
      ValidationContext context=scaHandler.execute(new SaveBean(MentoringProgram.class, program));
      mentoringServiceBase.validateContext(context);
      }else{
           throw new ServiceApplicationException("Cannot delete the program! because the program status"
                                                 +program.getStatus()+"not equals to target stauts"+cmd.getTargetStatus());
    }
    return null;

  }

}
